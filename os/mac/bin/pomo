#!/usr/bin/env bb
;; attempt to gamify pomodoros by unlocking symbols

(require '[babashka.pods :as pods])
(pods/load-pod 'org.babashka/buddy "0.1.0")

(require '[pod.babashka.buddy.core.hash :as hash]
         '[clojure.string :as string]
         '[clojure.java.shell :as shell])
(import 'java.time.format.DateTimeFormatter
        'java.time.LocalDateTime)

(def treasure
  [;; alchemical symbols
   "ðŸœ€ðŸœðŸœ‚ðŸœƒðŸœ„ðŸœ…ðŸœ†ðŸœ‡ðŸœˆðŸœ‰ðŸœŠðŸœ‹ðŸœŒðŸœðŸœŽðŸœðŸœðŸœ‘ðŸœ’ðŸœ“ðŸœ”ðŸœ•ðŸœ–ðŸœ—ðŸœ˜ðŸœ™ðŸœšðŸœ›ðŸœœðŸœðŸœžðŸœŸðŸœ ðŸœ¡ðŸœ¢ðŸœ£ðŸœ¤ðŸœ¥ðŸœ¦ðŸœ§ðŸœ¨ðŸœ©ðŸœªðŸœ«ðŸœ¬ðŸœ­ðŸœ®ðŸœ¯ðŸœ°ðŸœ±ðŸœ²ðŸœ³ðŸœ´ðŸœµðŸœ¶ðŸœ·ðŸœ¸ðŸœ¹ðŸœºðŸœ»ðŸœ¼ðŸœ½ðŸœ¾ðŸœ¿ðŸ€ðŸðŸ‚ðŸƒðŸ„ðŸ…ðŸ†ðŸ‡ðŸˆðŸ‰ðŸŠðŸ‹ðŸŒðŸðŸŽðŸðŸðŸ‘ðŸ’ðŸ“ðŸ”ðŸ•ðŸ–ðŸ—ðŸ˜ðŸ™ðŸšðŸ›ðŸœðŸðŸžðŸŸðŸ ðŸ¡ðŸ¢ðŸ£ðŸ¤ðŸ¥ðŸ¦ðŸ§ðŸ¨ðŸ©ðŸªðŸ«ðŸ¬ðŸ­ðŸ®ðŸ¯ðŸ°ðŸ±ðŸ²ðŸ³"
   ;; cards
   "ðŸ‚ ðŸ‚¡ðŸ‚¢ðŸ‚£ðŸ‚¤ðŸ‚¥ðŸ‚¦ðŸ‚§ðŸ‚¨ðŸ‚©ðŸ‚ªðŸ‚«ðŸ‚¬ðŸ‚­ðŸ‚®ðŸ‚±ðŸ‚²ðŸ‚³ðŸ‚´ðŸ‚µðŸ‚¶ðŸ‚·ðŸ‚¸ðŸ‚¹ðŸ‚ºðŸ‚»ðŸ‚¼ðŸ‚½ðŸ‚¾ðŸ‚¿ðŸƒðŸƒ‚ðŸƒƒðŸƒ„ðŸƒ…ðŸƒ†ðŸƒ‡ðŸƒˆðŸƒ‰ðŸƒŠðŸƒ‹ðŸƒŒðŸƒðŸƒŽðŸƒðŸƒ‘ðŸƒ’ðŸƒ“ðŸƒ”ðŸƒ•ðŸƒ–ðŸƒ—ðŸƒ˜ðŸƒ™ðŸƒšðŸƒ›ðŸƒœðŸƒðŸƒžðŸƒŸðŸƒ ðŸƒ¡ðŸƒ¢ðŸƒ£ðŸƒ¤ðŸƒ¥ðŸƒ¦ðŸƒ§ðŸƒ¨ðŸƒ©ðŸƒªðŸƒ«ðŸƒ¬ðŸƒ­ðŸƒ®ðŸƒ¯ðŸƒ°ðŸƒ±ðŸƒ²ðŸƒ³ðŸƒ´ðŸƒµ"
   ;; chess/games
   "â™”â™•â™–â™—â™˜â™™â™šâ™›â™œâ™â™žâ™Ÿ"
   "ðŸ© ðŸ©¡ðŸ©¢ðŸ©£ðŸ©¤ðŸ©¥ðŸ©¦ðŸ©§ðŸ©¨ðŸ©©ðŸ©ªðŸ©«ðŸ©¬ðŸ©­"
   ;; misc symbols block
   "â˜€â˜â˜‚â˜ƒâ˜„â˜…â˜†â˜‡â˜ˆâ˜‰â˜Šâ˜‹â˜Œâ˜â˜Žâ˜â˜â˜‘â˜’â˜“â˜”â˜•â˜–â˜—â˜˜â˜™â˜šâ˜›â˜œâ˜â˜žâ˜Ÿâ˜ â˜¡â˜¢â˜£â˜¤â˜¥â˜¦â˜§â˜¨â˜©â˜ªâ˜«â˜¬â˜­â˜®â˜¯â˜°â˜±â˜²â˜³â˜´â˜µâ˜¶â˜·â˜¸â˜¹â˜ºâ˜»â˜¼â˜½â˜¾â˜¿â™€â™â™‚â™ƒâ™„â™…â™†â™‡â™ˆâ™‰â™Šâ™‹â™Œâ™â™Žâ™â™â™‘â™’â™“â™”â™•â™–â™—â™˜â™™â™šâ™›â™œâ™â™žâ™Ÿâ™ â™¡â™¢â™£â™¤â™¥â™¦â™§â™¨â™©â™ªâ™«â™¬â™­â™®â™¯â™°â™±â™²â™³â™´â™µâ™¶â™·â™¸â™¹â™ºâ™»â™¼â™½â™¾â™¿âš€âšâš‚âšƒâš„âš…âš†âš‡âšˆâš‰âšŠâš‹âšŒâšâšŽâšâšâš‘âš’âš“âš”âš•âš–âš—âš˜âš™âššâš›âšœâšâšžâšŸâš âš¡âš¢âš£âš¤âš¥âš¦âš§âš¨âš©âšªâš«âš¬âš­âš®âš¯âš°âš±âš²âš³âš´âšµâš¶âš·âš¸âš¹âšºâš»âš¼âš½âš¾âš¿â›€â›â›‚â›ƒâ›„â›…â›†â›‡â›ˆâ›‰â›Šâ›‹â›Œâ›â›Žâ›â›â›‘â›’â›“â›”â›•â›–â›—â›˜â›™â›šâ››â›œâ›â›žâ›Ÿâ› â›¡â›¢â›£â›¤â›¥â›¦â›§â›¨â›©â›ªâ›«â›¬â›­â›®â›¯â›°â›±â›²â›³â›´â›µâ›¶â›·â›¸â›¹â›ºâ›»â›¼â›½â›¾â›¿"
   ;; geometric shapes
   "â– â–¡Uâ–¢â–£â–¤â–¥â–¦â–§â–¨â–©â–ªâ–«â–¬â–­â–®â–¯â–°â–±â–²â–³â–´â–µâ–¶â–·â–¸â–¹â–ºâ–»â–¼â–½â–¾â–¿â—€â—â—‚â—ƒâ—„â—…â—†â—‡â—ˆâ—‰â—Šâ—‹â—Œâ—â—Žâ—â—â—‘â—’â—“â—”â—•â—–â——â—˜â—™â—šâ—›â—œâ—â—žâ—Ÿâ— â—¡â—¢â—£â—¤â—¥â—¦â—§â—¨â—©â—ªâ—«â—¬â—­â—®â—¯â—°â—±â—²â—³â—´â—µâ—¶â—·â—¸â—¹â—ºâ—»â—¼â—½â—¾â—¿"
   ;; greek alphabet
   "Î‘Î’Î“Î”Î•Î–Î—Î˜Î™ÎšÎ›ÎœÎÎžÎŸÎ Î¡Î£Î¤Î¥Î¦Î§Î¨Î©"
   ;; egyptian hieroglyphs
   "ð“€€ð“€ð“€‚ð“€ƒð“€„ð“€…ð“€†ð“€‡ð“€ˆð“€‰ð“€Šð“€‹ð“€Œð“€ð“€Žð“€ð“€ð“€‘ð“€’ð“€“ð“€”ð“€•ð“€–ð“€—ð“€˜ð“€™ð“€šð“€›ð“€œð“€ð“€žð“€Ÿð“€ ð“€¡ð“€¢ð“€£ð“€¤ð“€¥ð“€¦ð“€§ð“€¨ð“€©ð“€ªð“€«ð“€¬ð“€­ð“€®ð“€¯ð“€°ð“€±ð“€²ð“€³ð“€´ð“€µð“€¶ð“€·ð“€¸ð“€¹ð“€ºð“€»ð“€¼ð“€½ð“€¾ð“€¿ð“€ð“ð“‚ð“ƒð“„ð“…ð“†ð“‡ð“ˆð“‰ð“Šð“‹ð“Œð“ð“Žð“ð“ð“‘ð“’ð““ð“”ð“•ð“–ð“—ð“˜ð“™ð“šð“›ð“œð“ð“žð“Ÿð“ ð“¡ð“¢ð“£ð“¤ð“¥ð“¦ð“§ð“¨ð“©ð“ªð“«ð“¬ð“­ð“®ð“¯ð“°ð“±ð“²ð“³ð“´ð“µð“¶ð“·ð“¸ð“¹ð“ºð“»ð“¼ð“½ð“¾ð“¿ð“‚€ð“‚ð“‚‚ð“‚ƒð“‚„ð“‚…ð“‚†ð“‚‡ð“‚ˆð“‚‰ð“‚Šð“‚‹ð“‚Œð“‚ð“‚Žð“‚ð“‚ð“‚‘ð“‚’ð“‚“ð“‚”ð“‚•ð“‚–ð“‚—ð“‚˜ð“‚™ð“‚šð“‚›ð“‚œð“‚ð“‚žð“‚Ÿð“‚ ð“‚¡ð“‚¢ð“‚£ð“‚¤ð“‚¥ð“‚¦ð“‚§ð“‚¨ð“‚©ð“‚ªð“‚«ð“‚¬ð“‚­ð“‚®ð“‚¯ð“‚°ð“‚±ð“‚²ð“‚³ð“‚´ð“‚µð“‚¶ð“‚·ð“‚¸ð“‚¹ð“‚ºð“‚»ð“‚¼ð“‚½ð“‚¾ð“‚¿ð“ƒ€ð“ƒð“ƒ‚ð“ƒƒð“ƒ„ð“ƒ…ð“ƒ†ð“ƒ‡ð“ƒˆð“ƒ‰ð“ƒŠð“ƒ‹ð“ƒŒð“ƒð“ƒŽð“ƒð“ƒð“ƒ‘ð“ƒ’ð“ƒ“ð“ƒ”ð“ƒ•ð“ƒ–ð“ƒ—ð“ƒ˜ð“ƒ™ð“ƒšð“ƒ›ð“ƒœð“ƒð“ƒžð“ƒŸð“ƒ ð“ƒ¡ð“ƒ¢ð“ƒ£ð“ƒ¤ð“ƒ¥ð“ƒ¦ð“ƒ§ð“ƒ¨ð“ƒ©ð“ƒªð“ƒ«ð“ƒ¬ð“ƒ­ð“ƒ®ð“ƒ¯ð“ƒ°ð“ƒ±ð“ƒ²ð“ƒ³ð“ƒ´ð“ƒµð“ƒ¶ð“ƒ·ð“ƒ¸ð“ƒ¹ð“ƒºð“ƒ»ð“ƒ¼ð“ƒ½ð“ƒ¾ð“ƒ¿ð“„€ð“„ð“„‚ð“„ƒð“„„ð“„…ð“„†ð“„‡ð“„ˆð“„‰ð“„Šð“„‹ð“„Œð“„ð“„Žð“„ð“„ð“„‘ð“„’ð“„“ð“„”ð“„•ð“„–ð“„—ð“„˜ð“„™ð“„šð“„›ð“„œð“„ð“„žð“„Ÿð“„ ð“„¡ð“„¢ð“„£ð“„¤ð“„¥ð“„¦ð“„§ð“„¨ð“„©ð“„ªð“„«ð“„¬ð“„­ð“„®ð“„¯ð“„°ð“„±ð“„²ð“„³ð“„´ð“„µð“„¶ð“„·ð“„¸ð“„¹ð“„ºð“„»ð“„¼ð“„½ð“„¾ð“„¿ð“…€ð“…ð“…‚ð“…ƒð“…„ð“……ð“…†ð“…‡ð“…ˆð“…‰ð“…Šð“…‹ð“…Œð“…ð“…Žð“…ð“…ð“…‘ð“…’ð“…“ð“…”ð“…•ð“…–ð“…—ð“…˜ð“…™ð“…šð“…›ð“…œð“…ð“…žð“…Ÿð“… ð“…¡ð“…¢ð“…£ð“…¤ð“…¥ð“…¦ð“…§ð“…¨ð“…©ð“…ªð“…«ð“…¬ð“…­ð“…®ð“…¯ð“…°ð“…±ð“…²ð“…³ð“…´ð“…µð“…¶ð“…·ð“…¸ð“…¹ð“…ºð“…»ð“…¼ð“…½ð“…¾ð“…¿ð“†€ð“†ð“†‚ð“†ƒð“†„ð“†…ð“††ð“†‡ð“†ˆð“†‰ð“†Šð“†‹ð“†Œð“†ð“†Žð“†ð“†ð“†‘ð“†’ð“†“ð“†”ð“†•ð“†–ð“†—ð“†˜ð“†™ð“†šð“†›ð“†œð“†ð“†žð“†Ÿð“† ð“†¡ð“†¢ð“†£ð“†¤ð“†¥ð“†¦ð“†§ð“†¨ð“†©ð“†ªð“†«ð“†¬ð“†­ð“†®ð“†¯ð“†°ð“†±ð“†²ð“†³ð“†´ð“†µð“†¶ð“†·ð“†¸ð“†¹ð“†ºð“†»ð“†¼ð“†½ð“†¾ð“†¿ð“‡€ð“‡ð“‡‚ð“‡ƒð“‡„ð“‡…ð“‡†ð“‡‡ð“‡ˆð“‡‰ð“‡Šð“‡‹ð“‡Œð“‡ð“‡Žð“‡ð“‡ð“‡‘ð“‡’ð“‡“ð“‡”ð“‡•ð“‡–ð“‡—ð“‡˜ð“‡™ð“‡šð“‡›ð“‡œð“‡ð“‡žð“‡Ÿð“‡ ð“‡¡ð“‡¢ð“‡£ð“‡¤ð“‡¥ð“‡¦ð“‡§ð“‡¨ð“‡©ð“‡ªð“‡«ð“‡¬ð“‡­ð“‡®ð“‡¯ð“‡°ð“‡±ð“‡²ð“‡³ð“‡´ð“‡µð“‡¶ð“‡·ð“‡¸ð“‡¹ð“‡ºð“‡»ð“‡¼ð“‡½ð“‡¾ð“‡¿ð“ˆ€ð“ˆð“ˆ‚ð“ˆƒð“ˆ„ð“ˆ…ð“ˆ†ð“ˆ‡ð“ˆˆð“ˆ‰ð“ˆŠð“ˆ‹ð“ˆŒð“ˆð“ˆŽð“ˆð“ˆð“ˆ‘ð“ˆ’ð“ˆ“ð“ˆ”ð“ˆ•ð“ˆ–ð“ˆ—ð“ˆ˜ð“ˆ™ð“ˆšð“ˆ›ð“ˆœð“ˆð“ˆžð“ˆŸð“ˆ ð“ˆ¡ð“ˆ¢ð“ˆ£ð“ˆ¤ð“ˆ¥ð“ˆ¦ð“ˆ§ð“ˆ¨ð“ˆ©ð“ˆªð“ˆ«ð“ˆ¬ð“ˆ­ð“ˆ®ð“ˆ¯ð“ˆ°ð“ˆ±ð“ˆ²ð“ˆ³ð“ˆ´ð“ˆµð“ˆ¶ð“ˆ·ð“ˆ¸ð“ˆ¹ð“ˆºð“ˆ»ð“ˆ¼ð“ˆ½ð“ˆ¾ð“ˆ¿ð“‰€ð“‰ð“‰‚ð“‰ƒð“‰„ð“‰…ð“‰†ð“‰‡ð“‰ˆð“‰‰ð“‰Šð“‰‹ð“‰Œð“‰ð“‰Žð“‰ð“‰ð“‰‘ð“‰’ð“‰“ð“‰”ð“‰•ð“‰–ð“‰—ð“‰˜ð“‰™ð“‰šð“‰›ð“‰œð“‰ð“‰žð“‰Ÿð“‰ ð“‰¡ð“‰¢ð“‰£ð“‰¤ð“‰¥ð“‰¦ð“‰§ð“‰¨ð“‰©ð“‰ªð“‰«ð“‰¬ð“‰­ð“‰®ð“‰¯ð“‰°ð“‰±ð“‰²ð“‰³ð“‰´ð“‰µð“‰¶ð“‰·ð“‰¸ð“‰¹ð“‰ºð“‰»ð“‰¼ð“‰½ð“‰¾ð“‰¿ð“Š€ð“Šð“Š‚ð“Šƒð“Š„ð“Š…ð“Š†ð“Š‡ð“Šˆð“Š‰ð“ŠŠð“Š‹ð“ŠŒð“Šð“ŠŽð“Šð“Šð“Š‘ð“Š’ð“Š“ð“Š”ð“Š•ð“Š–ð“Š—ð“Š˜ð“Š™ð“Ššð“Š›ð“Šœð“Šð“Šžð“ŠŸð“Š ð“Š¡ð“Š¢ð“Š£ð“Š¤ð“Š¥ð“Š¦ð“Š§ð“Š¨ð“Š©ð“Šªð“Š«ð“Š¬ð“Š­ð“Š®ð“Š¯ð“Š°ð“Š±ð“Š²ð“Š³ð“Š´ð“Šµð“Š¶ð“Š·ð“Š¸ð“Š¹ð“Šºð“Š»ð“Š¼ð“Š½ð“Š¾ð“Š¿ð“‹€ð“‹ð“‹‚ð“‹ƒð“‹„ð“‹…ð“‹†ð“‹‡ð“‹ˆð“‹‰ð“‹Šð“‹‹ð“‹Œð“‹ð“‹Žð“‹ð“‹ð“‹‘ð“‹’ð“‹“ð“‹”ð“‹•ð“‹–ð“‹—ð“‹˜ð“‹™ð“‹šð“‹›ð“‹œð“‹ð“‹žð“‹Ÿð“‹ ð“‹¡ð“‹¢ð“‹£ð“‹¤ð“‹¥ð“‹¦ð“‹§ð“‹¨ð“‹©ð“‹ªð“‹«ð“‹¬ð“‹­ð“‹®ð“‹¯ð“‹°ð“‹±ð“‹²ð“‹³ð“‹´ð“‹µð“‹¶ð“‹·ð“‹¸ð“‹¹ð“‹ºð“‹»ð“‹¼ð“‹½ð“‹¾ð“‹¿ð“Œ€ð“Œð“Œ‚ð“Œƒð“Œ„ð“Œ…ð“Œ†ð“Œ‡ð“Œˆð“Œ‰ð“ŒŠð“Œ‹ð“ŒŒð“Œð“ŒŽð“Œð“Œð“Œ‘ð“Œ’ð“Œ“ð“Œ”ð“Œ•ð“Œ–ð“Œ—ð“Œ˜ð“Œ™ð“Œšð“Œ›ð“Œœð“Œð“Œžð“ŒŸð“Œ ð“Œ¡ð“Œ¢ð“Œ£ð“Œ¤ð“Œ¥ð“Œ¦ð“Œ§ð“Œ¨ð“Œ©ð“Œªð“Œ«ð“Œ¬ð“Œ­ð“Œ®ð“Œ¯ð“Œ°ð“Œ±ð“Œ²ð“Œ³ð“Œ´ð“Œµð“Œ¶ð“Œ·ð“Œ¸ð“Œ¹ð“Œºð“Œ»ð“Œ¼ð“Œ½ð“Œ¾ð“Œ¿ð“€ð“ð“‚ð“ƒð“„ð“…ð“†ð“‡ð“ˆð“‰ð“Šð“‹ð“Œð“ð“Žð“ð“ð“‘ð“’ð““ð“”ð“•ð“–ð“—ð“˜ð“™ð“šð“›ð“œð“ð“žð“Ÿð“ ð“¡ð“¢ð“£ð“¤ð“¥ð“¦ð“§ð“¨ð“©ð“ªð“«ð“¬ð“­ð“®ð“¯ð“°ð“±ð“²ð“³ð“´ð“µð“¶ð“·ð“¸ð“¹ð“ºð“»ð“¼ð“½ð“¾ð“¿ð“Ž€ð“Žð“Ž‚ð“Žƒð“Ž„ð“Ž…ð“Ž†ð“Ž‡ð“Žˆð“Ž‰ð“ŽŠð“Ž‹ð“ŽŒð“Žð“ŽŽð“Žð“Žð“Ž‘ð“Ž’ð“Ž“ð“Ž”ð“Ž•ð“Ž–ð“Ž—ð“Ž˜ð“Ž™ð“Žšð“Ž›ð“Žœð“Žð“Žžð“ŽŸð“Ž ð“Ž¡ð“Ž¢ð“Ž£ð“Ž¤ð“Ž¥ð“Ž¦ð“Ž§ð“Ž¨ð“Ž©ð“Žªð“Ž«ð“Ž¬ð“Ž­ð“Ž®ð“Ž¯ð“Ž°ð“Ž±ð“Ž²ð“Ž³ð“Ž´ð“Žµð“Ž¶ð“Ž·ð“Ž¸ð“Ž¹ð“Žºð“Ž»ð“Ž¼ð“Ž½ð“Ž¾ð“Ž¿ð“€ð“ð“‚ð“ƒð“„ð“…ð“†ð“‡ð“ˆð“‰ð“Šð“‹ð“Œð“ð“Žð“ð“ð“‘ð“’ð““ð“”ð“•ð“–ð“—ð“˜ð“™ð“šð“›ð“œð“ð“žð“Ÿð“ ð“¡ð“¢ð“£ð“¤ð“¥ð“¦ð“§ð“¨ð“©ð“ªð“«ð“¬ð“­ð“®ð“¯ð“°ð“±ð“²ð“³ð“´ð“µð“¶ð“·ð“¸ð“¹ð“ºð“»ð“¼ð“½ð“¾ð“¿ð“€ð“ð“‚ð“ƒð“„ð“…ð“†ð“‡ð“ˆð“‰ð“Šð“‹ð“Œð“ð“Žð“ð“ð“‘ð“’ð““ð“”ð“•ð“–ð“—ð“˜ð“™ð“šð“›ð“œð“ð“žð“Ÿð“ ð“¡ð“¢ð“£ð“¤ð“¥ð“¦ð“§ð“¨ð“©ð“ªð“«ð“¬ð“­"
   ;; runes
   "áš áš¡áš¢áš£áš¤áš¥áš¦áš§áš¨áš©ášªáš«áš¬áš­áš®áš¯áš°áš±áš²áš³áš´ášµáš¶áš·áš¸áš¹ášºáš»áš¼áš½áš¾áš¿á›€á›á›‚á›ƒá›„á›…á›†á›‡á›ˆá›‰á›Šá›‹á›Œá›á›Žá›á›á›‘á›’á›“á›”á›•á›–á›—á›˜á›™á›šá››á›œá›á›žá›Ÿá› á›¡á›¢á›£á›¤á›¥á›¦á›§á›¨á›©á›ªá›«á›¬á›­á›®á›¯á›°á›±á›²á›³á›´á›µá›¶á›·á›¸"
   ])

(defn elisp-char-name [char]
  (if (= char "ê©œ")
    " â€½â€½â€½UNKNOWNâ€½â€½â€½"
    (string/trim (:out (shell/sh "elisp" "-r" (format "(get-char-code-property ?%s 'name)" char))))))

(defn bytes-to-int
  ([bytes]
   (bytes-to-int bytes 0))
  ([bytes offset]
   (reduce + 0
           (map (fn [i]
                  (let [shift (* (- 4 1 i)
                                 8)]
                    (bit-shift-left (bit-and (nth bytes (+ i offset))
                                             0x000000FF)
                                    shift)))
                (range 0 4)))))

(defn loot [s]
  ;; in the future, we might do something like a treasure-theme with the day
  ;; (like today -> treasure index)
  ;; for now just sticking to the first collection, alchemy
  (let [treasure (first treasure)
        treasure (map first (re-seq #"(U?)." treasure))]
    (-> s
        (hash/md5)
        (bytes-to-int)
        (mod (count treasure))
        (->> (nth treasure)))))

(def state-file "/tmp/pomo-state")
(def state {})
(def today (.format (LocalDateTime/now) (DateTimeFormatter/ofPattern "yyyy-MM-dd")))

(defn load-state []
  (def state
    (when (.exists (io/file state-file))
      (-> state-file slurp read-string)))
  (let [date (:date state)]
    (when-not (= date today)
      ;; reset!
      (def state
        {:date today
         :done 0
         :goal 4}))))

(defn save-state []
  (->> state pr-str (spit state-file)))

(defn state-to-symbols []
  (let [done (:done state)
        goal (:goal state)]
    (->> (range done)
         (map (fn [i] (format "%s %s-%s"
                              (.. java.net.InetAddress getLocalHost getHostName)
                              today (inc i))))
         (map loot)
         (#(concat % (repeat (- goal done) "ê©œ"))))))

(defn summary []
  (println (format "symbols for %s" today))
  (->> (state-to-symbols)
       (map (juxt identity elisp-char-name))
       (map (partial apply format "%s %s"))
       (string/join "\n")
       (println)))

(defn status []
  (println (string/join (state-to-symbols))))

(defn done []
  (def state (update-in state [:done] inc))
  (println "You completed a pomodoro ")
  (summary)
  (save-state))

(defn goal [new-goal]
  (def state (assoc state :goal (read-string new-goal)))
  (println "Updated goal!")
  (summary)
  (save-state))

(load-state)

(let [[cmd & args] *command-line-args*
      cmd (some-> cmd read-string resolve)]
  (apply (or cmd summary) args))

(System/exit 0)
