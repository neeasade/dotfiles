#!/usr/bin/env bb
;; ugh

(def pomo-done 2)
(def pomo-goal 4)

(def alchemy-map
  (partition
   2
   ["ðŸœ€" "ALCHEMICAL SYMBOL FOR QUINTESSENCE"
    "ðŸœ" "ALCHEMICAL SYMBOL FOR AIR"
    "ðŸœ‚" "ALCHEMICAL SYMBOL FOR FIRE"
    "ðŸœƒ" "ALCHEMICAL SYMBOL FOR EARTH"
    "ðŸœ„" "ALCHEMICAL SYMBOL FOR WATER"
    "ðŸœ…" "ALCHEMICAL SYMBOL FOR AQUAFORTIS"
    "ðŸœ†" "ALCHEMICAL SYMBOL FOR AQUA REGIA"
    "ðŸœ‡" "ALCHEMICAL SYMBOL FOR AQUA REGIA-2"
    "ðŸœˆ" "ALCHEMICAL SYMBOL FOR AQUA VITAE"
    "ðŸœ‰" "ALCHEMICAL SYMBOL FOR AQUA VITAE-2"
    "ðŸœŠ" "ALCHEMICAL SYMBOL FOR VINEGAR"
    "ðŸœ‹" "ALCHEMICAL SYMBOL FOR VINEGAR-2"
    "ðŸœŒ" "ALCHEMICAL SYMBOL FOR VINEGAR-3"
    "ðŸœ" "ALCHEMICAL SYMBOL FOR SULFUR"
    "ðŸœŽ" "ALCHEMICAL SYMBOL FOR PHILOSOPHERS SULFUR"
    "ðŸœ" "ALCHEMICAL SYMBOL FOR BLACK SULFUR"
    "ðŸœ" "ALCHEMICAL SYMBOL FOR MERCURY SUBLIMATE"
    "ðŸœ‘" "ALCHEMICAL SYMBOL FOR MERCURY SUBLIMATE-2"
    "ðŸœ’" "ALCHEMICAL SYMBOL FOR MERCURY SUBLIMATE-3"
    "ðŸœ“" "ALCHEMICAL SYMBOL FOR CINNABAR"
    "ðŸœ”" "ALCHEMICAL SYMBOL FOR SALT"
    "ðŸœ•" "ALCHEMICAL SYMBOL FOR NITRE"
    "ðŸœ–" "ALCHEMICAL SYMBOL FOR VITRIOL"
    "ðŸœ—" "ALCHEMICAL SYMBOL FOR VITRIOL-2"
    "ðŸœ˜" "ALCHEMICAL SYMBOL FOR ROCK SALT"
    "ðŸœ™" "ALCHEMICAL SYMBOL FOR ROCK SALT-2"
    "ðŸœš" "ALCHEMICAL SYMBOL FOR GOLD"
    "ðŸœ›" "ALCHEMICAL SYMBOL FOR SILVER"
    "ðŸœœ" "ALCHEMICAL SYMBOL FOR IRON ORE"
    "ðŸœ" "ALCHEMICAL SYMBOL FOR IRON ORE-2"
    "ðŸœž" "ALCHEMICAL SYMBOL FOR CROCUS OF IRON"
    "ðŸœŸ" "ALCHEMICAL SYMBOL FOR REGULUS OF IRON"
    "ðŸœ " "ALCHEMICAL SYMBOL FOR COPPER ORE"
    "ðŸœ¡" "ALCHEMICAL SYMBOL FOR IRON-COPPER ORE"
    "ðŸœ¢" "ALCHEMICAL SYMBOL FOR SUBLIMATE OF COPPER"
    "ðŸœ£" "ALCHEMICAL SYMBOL FOR CROCUS OF COPPER"
    "ðŸœ¤" "ALCHEMICAL SYMBOL FOR CROCUS OF COPPER-2"
    "ðŸœ¥" "ALCHEMICAL SYMBOL FOR COPPER ANTIMONIATE"
    "ðŸœ¦" "ALCHEMICAL SYMBOL FOR SALT OF COPPER ANTIMONIATE"
    "ðŸœ§" "ALCHEMICAL SYMBOL FOR SUBLIMATE OF SALT OF COPPER"
    "ðŸœ¨" "ALCHEMICAL SYMBOL FOR VERDIGRIS"
    "ðŸœ©" "ALCHEMICAL SYMBOL FOR TIN ORE"
    "ðŸœª" "ALCHEMICAL SYMBOL FOR LEAD ORE"
    "ðŸœ«" "ALCHEMICAL SYMBOL FOR ANTIMONY ORE"
    "ðŸœ¬" "ALCHEMICAL SYMBOL FOR SUBLIMATE OF ANTIMONY"
    "ðŸœ­" "ALCHEMICAL SYMBOL FOR SALT OF ANTIMONY"
    "ðŸœ®" "ALCHEMICAL SYMBOL FOR SUBLIMATE OF SALT OF ANTIMONY"
    "ðŸœ¯" "ALCHEMICAL SYMBOL FOR VINEGAR OF ANTIMONY"
    "ðŸœ°" "ALCHEMICAL SYMBOL FOR REGULUS OF ANTIMONY"
    "ðŸœ±" "ALCHEMICAL SYMBOL FOR REGULUS OF ANTIMONY-2"
    "ðŸœ²" "ALCHEMICAL SYMBOL FOR REGULUS"
    "ðŸœ³" "ALCHEMICAL SYMBOL FOR REGULUS-2"
    "ðŸœ´" "ALCHEMICAL SYMBOL FOR REGULUS-3"
    "ðŸœµ" "ALCHEMICAL SYMBOL FOR REGULUS-4"
    "ðŸœ¶" "ALCHEMICAL SYMBOL FOR ALKALI"
    "ðŸœ·" "ALCHEMICAL SYMBOL FOR ALKALI-2"
    "ðŸœ¸" "ALCHEMICAL SYMBOL FOR MARCASITE"
    "ðŸœ¹" "ALCHEMICAL SYMBOL FOR SAL-AMMONIAC"
    "ðŸœº" "ALCHEMICAL SYMBOL FOR ARSENIC"
    "ðŸœ»" "ALCHEMICAL SYMBOL FOR REALGAR"
    "ðŸœ¼" "ALCHEMICAL SYMBOL FOR REALGAR-2"
    "ðŸœ½" "ALCHEMICAL SYMBOL FOR AURIPIGMENT"
    "ðŸœ¾" "ALCHEMICAL SYMBOL FOR BISMUTH ORE"
    "ðŸœ¿" "ALCHEMICAL SYMBOL FOR TARTAR"
    "ðŸ€" "ALCHEMICAL SYMBOL FOR TARTAR-2"
    "ðŸ" "ALCHEMICAL SYMBOL FOR QUICK LIME"
    "ðŸ‚" "ALCHEMICAL SYMBOL FOR BORAX"
    "ðŸƒ" "ALCHEMICAL SYMBOL FOR BORAX-2"
    "ðŸ„" "ALCHEMICAL SYMBOL FOR BORAX-3"
    "ðŸ…" "ALCHEMICAL SYMBOL FOR ALUM"
    "ðŸ†" "ALCHEMICAL SYMBOL FOR OIL"
    "ðŸ‡" "ALCHEMICAL SYMBOL FOR SPIRIT"
    "ðŸˆ" "ALCHEMICAL SYMBOL FOR TINCTURE"
    "ðŸ‰" "ALCHEMICAL SYMBOL FOR GUM"
    "ðŸŠ" "ALCHEMICAL SYMBOL FOR WAX"
    "ðŸ‹" "ALCHEMICAL SYMBOL FOR POWDER"
    "ðŸŒ" "ALCHEMICAL SYMBOL FOR CALX"
    "ðŸ" "ALCHEMICAL SYMBOL FOR TUTTY"
    "ðŸŽ" "ALCHEMICAL SYMBOL FOR CAPUT MORTUUM"
    "ðŸ" "ALCHEMICAL SYMBOL FOR SCEPTER OF JOVE"
    "ðŸ" "ALCHEMICAL SYMBOL FOR CADUCEUS"
    "ðŸ‘" "ALCHEMICAL SYMBOL FOR TRIDENT"
    "ðŸ’" "ALCHEMICAL SYMBOL FOR STARRED TRIDENT"
    "ðŸ“" "ALCHEMICAL SYMBOL FOR LODESTONE"
    "ðŸ”" "ALCHEMICAL SYMBOL FOR SOAP"
    "ðŸ•" "ALCHEMICAL SYMBOL FOR URINE"
    "ðŸ–" "ALCHEMICAL SYMBOL FOR HORSE DUNG"
    "ðŸ—" "ALCHEMICAL SYMBOL FOR ASHES"
    "ðŸ˜" "ALCHEMICAL SYMBOL FOR POT ASHES"
    "ðŸ™" "ALCHEMICAL SYMBOL FOR BRICK"
    "ðŸš" "ALCHEMICAL SYMBOL FOR POWDERED BRICK"
    "ðŸ›" "ALCHEMICAL SYMBOL FOR AMALGAM"
    "ðŸœ" "ALCHEMICAL SYMBOL FOR STRATUM SUPER STRATUM"
    "ðŸ" "ALCHEMICAL SYMBOL FOR STRATUM SUPER STRATUM-2"
    "ðŸž" "ALCHEMICAL SYMBOL FOR SUBLIMATION"
    "ðŸŸ" "ALCHEMICAL SYMBOL FOR PRECIPITATE"
    "ðŸ " "ALCHEMICAL SYMBOL FOR DISTILL"
    "ðŸ¡" "ALCHEMICAL SYMBOL FOR DISSOLVE"
    "ðŸ¢" "ALCHEMICAL SYMBOL FOR DISSOLVE-2"
    "ðŸ£" "ALCHEMICAL SYMBOL FOR PURIFY"
    "ðŸ¤" "ALCHEMICAL SYMBOL FOR PUTREFACTION"
    "ðŸ¥" "ALCHEMICAL SYMBOL FOR CRUCIBLE"
    "ðŸ¦" "ALCHEMICAL SYMBOL FOR CRUCIBLE-2"
    "ðŸ§" "ALCHEMICAL SYMBOL FOR CRUCIBLE-3"
    "ðŸ¨" "ALCHEMICAL SYMBOL FOR CRUCIBLE-4"
    "ðŸ©" "ALCHEMICAL SYMBOL FOR CRUCIBLE-5"
    "ðŸª" "ALCHEMICAL SYMBOL FOR ALEMBIC"
    "ðŸ«" "ALCHEMICAL SYMBOL FOR BATH OF MARY"
    "ðŸ¬" "ALCHEMICAL SYMBOL FOR BATH OF VAPOURS"
    "ðŸ­" "ALCHEMICAL SYMBOL FOR RETORT"
    "ðŸ®" "ALCHEMICAL SYMBOL FOR HOUR"
    "ðŸ¯" "ALCHEMICAL SYMBOL FOR NIGHT"
    "ðŸ°" "ALCHEMICAL SYMBOL FOR DAY-NIGHT"
    "ðŸ±" "ALCHEMICAL SYMBOL FOR MONTH"
    "ðŸ²" "ALCHEMICAL SYMBOL FOR HALF DRAM"
    "ðŸ³" "ALCHEMICAL SYMBOL FOR HALF OUNCE"
    ]))


(require '[babashka.pods :as pods])
(pods/load-pod 'org.babashka/buddy "0.1.0")

(require '[pod.babashka.buddy.core.hash :as hash])

(require '[clojure.string :as string])

(import 'java.time.format.DateTimeFormatter
        'java.time.LocalDateTime)

(defn bytes-to-int
  ([bytes]
   (bytes-to-int bytes 0))
  ([bytes offset]
   (reduce + 0
           (map (fn [i]
                  (let [shift (* (- 4 1 i)
                                 8)]
                    (bit-shift-left (bit-and (nth bytes (+ i offset))
                                             0x000000FF)
                                    shift)))
                (range 0 4)))))

(defn string-to-symbol [s]
  (nth alchemy-map
       (-> s
           (hash/md5)
           (bytes-to-int)
           (mod (count alchemy-map)))))

(let [date (LocalDateTime/now)
      formatter (DateTimeFormatter/ofPattern "yyyy-MM-dd")
      today (.format date formatter)
      done-symbols (->> (range pomo-done)
                        (map (fn [i] (format "%s-%s" today (inc i))))
                        (map string-to-symbol))

      done-symbols (concat done-symbols
                           (repeat (- pomo-goal pomo-done)
                                   ["ê©œ" " â€½â€½â€½UNKNOWNâ€½â€½â€½"]))]
  (if (= (first *command-line-args*) "status")
    (println
     (string/join
      (map first done-symbols)))

    ;; cli
    (do
      (println (format "symbols for %s" today))
      (->> done-symbols
           (map (partial apply format "%s %s"))
           (map println)
           (doall)))))

(System/exit 0)
