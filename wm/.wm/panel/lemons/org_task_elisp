#!/usr/bin/env elisp
;; HACK: use ^ to delimit percent and topic.

(defun ns/org-pomo-progress (length-minutes)
  "percent through current pomodoro state"
  (->> (/ (- (* length-minutes 60)
	     (org-pomodoro-remaining-seconds))
	  (* length-minutes 60))
       (* 100)))

(if (eq org-pomodoro-state :none)
    (progn
      ;; cascade:
      ;; make standup for today
      ;; resume: first headline in standup for today
      "TODO^"
      )
  ;;
  (let ((percent
	 (ns/org-pomo-progress
	  (alist-get
	   org-pomodoro-state
	   `((:short-break . ,org-pomodoro-short-break-length)
	     (:long-break . ,org-pomodoro-long-break-length)
	     (:pomodoro . ,org-pomodoro-length))))))
    (format "%s^%s"
	    (s-clean org-clock-current-task)
	    (ns/let-script-args (width) (floor (* (string-to-number width) (/ percent 100)))))
    ;; percent
    ))
