#!/bin/sh

# ;; OK: underline when inactive but with wids
# ;; else just background color if active, no background if not turned on

while read -r _; do
    meta start
    meta set fg 111111

    btags state-plain | while read -r line; do
	# meta reset
	# meta set bg \#00111111
	name=$(echo "$line" | awk -F\| '{print $1}')
	wids=$(echo "$line" | awk -F\| '{print $4}')
	color=$(echo "$line" | awk -F\| '{print $3}')

	# todo: if it's empty, it might as well be toggled off

        meta mouse_left btags toggle $name

	if echo "$line" | grep -q true; then
	    # meta set line \#ff$color
	    meta set bg \#$color
	else
	    if [ -z "$wids" ]; then
		# meta set line \#00000000
		meta set bg \#00111111
	    else
		# meta set underline true
		# meta set line \#ff000000
		meta set bg \#00111111
		name="[${name}]"
	    fi
	fi

	# meta underline
	echo "   ${name}   "
    done

    meta end
    echo
done
