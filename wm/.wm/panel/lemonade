#!/usr/bin/env bash
# a wrapper to launch lemonade on every monitor, as determined by bspwm

set -a
height=30
gap=10
iconfont=awesome

# relevance
cd $(dirname $([ -L $0  ] && readlink -f $0 || echo $0))
PATH=$PATH:`pwd`/tools

# mon dim
dim() {
	bspc query -T -m $1 | jq .rectangle.$2
}

bspc config top_padding $(( height+gap ))

i=0
for mon in $(bspc query -M); do
	i=$(($i+1))
	conf=`ls juicers | sed -n "$i p"`
	[ -z "$conf" ] && conf=`ls juicers | sed -n "1 p"`
	geom="$(( $(dim $mon width)-(gap*2) ))x$height+$(( $(dim $mon x)+gap ))+$gap"
	export mon
	tools/lemonade "$conf" "$geom" &
done

trap "bspc config top_padding 0; trap - TERM; kill -s TERM 0;" INT ERR TERM QUIT

# where are we?
echo $$ > /tmp/panel-pid

wait
