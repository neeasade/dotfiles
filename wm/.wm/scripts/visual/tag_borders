#!/bin/sh
# draw a borders according to the group some wid is in

normal=$(theme getval b_normal_border_color)
focused=$(theme getval b_focused_border_color)

b_width=$(bspc config border_width)

# you can move this into the render function

draw() {
    active=$(bspwindows)
    state=$(btags state-plain)

    for wid in $active $(bspwindows inactive); do
	tag=$(echo "$state" | awk -F \| "/$wid/{print \$4}" | head -n 1)
	if [ -z "$tag" ]; then
	    if echo "$active" | grep -q "$wid"; then
		chwbn \
		    -b $(( b_width-4 )) \
		    -b $(( 4 )) \
		    -c 000000 \
		    -c 666666 \
		    $wid
	    else
		chwbn -b $b_width -c 000000 $wid
	    fi
	else
	    color=$(echo "$state" | awk -F \| "/$wid/{print \$3}" | head -n 1)

	    if echo "$active" | grep -q "$wid"; then
		chwbn \
		    -b $(( b_width-4 )) \
		    -b $(( 4 )) \
		    -c $color \
		    -c $(colort -l -40 $color) \
		    $wid
	    else
		chwbn -b $b_width -c $color $wid
	    fi
	fi
    done
}

draw
# bspc subscribe node_flag node_state node_geometry node_focus | debounce.sh 0.1 | while read msg; do
bspc subscribe node_flag node_state node_geometry node_focus | while read msg; do
    draw
done
