#!/bin/bash
# dzen2 calendar with dynamic width that matches panel colors and font
# depends: txtw, xdotool
# works on multihead, accounts for virtual window mismatches using bspc information
# todo: clean this.

. ~/.bspwm_theme

# handle the fonts I use - Monospace is better here.
PANEL_FONT_MAIN=`sed 's/Droid Sans/Droid Sans Mono/; s/:style=Bold//; s/Dejavu Sans/Dejavu Sans Mono/' <<< "$PANEL_FONT_MAIN"`

# dynamic width using txtw
font_size="${PANEL_FONT_MAIN#*-}"
font_name="${PANEL_FONT_MAIN%-*}"

# txtw seems to be off by one..
font_size=`expr $font_size + 1`

width=$(txtw -f "xft:$font_name:style=Regular" -s $font_size "$(cal | sed -n "4 p" | sed "s/ /a/g")" )

TODAY=$(expr `date +'%d'` + 0)
MONTH=`date +'%m'`
YEAR=`date +'%Y'`

# highlight current date
(
cal | sed -re "s/^(.*[A-Za-z][A-Za-z]*.*)$/^fg(#$pFG)^bg(#$pBG)\1/;
s/(^|[ ])($TODAY)($|[ ])/\1^bg(#$pBGActiveTab)^fg(#$pBG)\2^fg(#$pFG)^bg(#$pBG)\3/"
) | eval dzen2 $(dzen_options)
